{% extends "digital-land-frontend/dlf-base.html" %}
{%- from "digital-land-frontend/components/map/macro.html" import dlMap %}
{%- from "digital-land-frontend/components/index-list/macro.html" import dlIndexList %}

{%- block pageTitle %}{{ data_type|capitalize }} | Digital Land{% endblock -%}

{%- block head %}
{{ super() }}
<script src="{{ staticPath|default('/static') }}/javascripts/dl-maps.js"></script>
{%- endblock  %}

{%- block beforeContent -%}
    {{ super() }}

    {{- govukBreadcrumbs({
    "items": [
        {
        "text": "Digital Land USING YOUR TEMPLATE",
        "href": "/"
        } ] + breadcrumb
    }) -}}
{%- endblock -%}

{% block content %}

GEOGRAPHIES: {{ index['geographies'] }}

{% block indexTitle -%}
<h1 class="govuk-heading-xl">{{ data_type|capitalize }}</h1>
{%- endblock %}

{% block indexDescription -%}
{%- if index['group_type'] and index['group_type'] == "organisation" %}
<p class="govuk-body">Showing {{ index['count'] }} records from {{ index['groups']|length }} organisation{{ "" if index['groups']|length == 1 else "s" }}.</p>
{% endif -%}
{%- endblock %}

{% block indexList -%}
{%- if index.groups %}
<div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
  {% for group in index['groups']  %}
  <div class="govuk-accordion__section ">
    <div class="govuk-accordion__section-header" id="{{ group }}">
      <h2 class="govuk-accordion__section-heading">
        <span class="govuk-accordion__section-button" id="accordion-default-heading-{{loop.index}}">
          {{ group|organisation_id_to_name }}
        </span>
      </h2>
    </div>
    <div id="accordion-default-content-{{loop.index}}" class="govuk-accordion__section-content" aria-labelledby="accordion-default-heading-{{loop.index}}">
      {{ dlIndexList({
        "items": index.groups[group]['items'],
        "data_type": data_type
      }) }}
    </div>
  </div> 
  {% endfor %}
</div>  
{%- else %}
{{ dlIndexList({
  "items": index["items"]
}) }}
{%- endif -%}
{%- endblock %}

{% block recordGeometry -%}
    {%- if 'geographies' in index and index['geographies'] %}

    <!-- include css and js for LeafletJS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>

    {#{{ dlMap({
        "id": "aMap",
        "classes": "govuk-!-margin-top-4 govuk-!-margin-bottom-2",
        "attributes": {
            "data-geojson-urls": index['geographies']
        },
        "height": "460"
    }) }}#}

    {{ dlMap({
        "id": "aMap",
        "classes": "govuk-!-margin-top-4 govuk-!-margin-bottom-2",
        "height": "460"
    }) }}
    
    {%- endif %}
{%- endblock recordGeometry %}

{% endblock content %}

{%- block bodyEnd %}
{{ super() }}
{%- if 'geographies' in index and index['geographies'] %}
<script>
    const $mapElement = document.querySelector('[data-module="boundary-map"]')
    const mapComponent = new DLMaps.Map($mapElement).init({
        geojsonURLs: {{index['geographies']|tojson}}
    })

</script>
{%- endif %}
{%- endblock %}
